<div>

  <ol class="breadcrumb">
    <li>Environnement {{ ctrl.scenario.testRun.env }}</li>
    <li class="active">
      <a ng-href="#/test-runs/{{ ctrl.scenario.testRun.id }}">
        Tir du {{ ctrl.scenario.testRun.date | date:'dd/MM/yyyy à HH:mm' }}
      </a>
    </li>
    <li class="active">
      <a href="#/features/{{ ctrl.scenario.featureId }}">
        {{ ctrl.scenario.feature.info.keyword + ' ' + ctrl.scenario.feature.info.name }}
      </a>
    </li>
    <li class="active">
      {{ ctrl.scenario.info.keyword + ' ' + ctrl.scenario.info.name }}
    </li>
  </ol>

  <!-- Header -->

  <h1>
    <tc-element-info info="ctrl.scenario.info"></tc-element-info>
    <small>
      <tc-status status="ctrl.scenario.status"></tc-status>
    </small>
  </h1>

  <p>
    <b>Créé le :</b>
    {{ ctrl.scenario.createdAt | date:'dd/MM/yyyy à HH:mm:ss' }}
  </p>

  <p ng-hide="ctrl.scenario.createdAt == ctrl.scenario.modifiedAt">
    <b>Modifié le :</b>
    {{ ctrl.scenario.modifiedAt | date:'dd/MM/yyyy à HH:mm:ss' }}
  </p>

  <p ng-if="ctrl.scenario.tags.length > 0">
    <b>Tags :</b>
    <tc-tags tags="ctrl.scenario.tags"></tc-tags>
  </p>

  <hr>

  <div class="btn-toolbar" role="toolbar">
    <div class="btn-group" role="group">

      <button type="button" class="btn btn-primary btn-default dropdown-toggle" data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false">
        Modifier le statut
        <span class="caret"></span>
      </button>

      <ul class="dropdown-menu">
        <li><a href ng-click="ctrl.changeStatus('PASSED')">Succès</a></li>
        <li><a href ng-click="ctrl.changeStatus('FAILED')">Échec</a></li>
        <li><a href ng-click="ctrl.changeStatus('NOT_RUN')">Non joué</a></li>
        <li><a href ng-click="ctrl.changeStatus('PENDING')">En attente</a></li>
      </ul>

    </div>
    <div class="btn-group" role="group">

      <button ng-click="ctrl.delete()" class="btn btn-danger btn-default">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
        Supprimer
      </button>

    </div>
  </div>

  <hr>

  <!-- Steps -->

  <h2>Etapes</h2>

  <p class="text-muted" ng-hide="ctrl.scenario.comment == ''">
    <tc-line-breaks content="ctrl.scenario.comment"></tc-line-breaks>
  </p>

  <div ng-repeat="action in ctrl.scenario.beforeActions">
    <p>
      <i><b>Pré-action</b> #{{ $index + 1 }}</i>
      <tc-status status="action.status"></tc-status>
    </p>
    <pre ng-if="action.errorMessage">{{ action.errorMessage }}</pre>
  </div>

  <div ng-if="ctrl.scenario.background" ng-repeat="step in ctrl.scenario.background.steps">

    <p>
      <i>
        <tc-element-info info="step.info"></tc-element-info>
      </i>
      <tc-status status="step.status"></tc-status>
    </p>

    <pre ng-if="step.errorMessage">{{ step.errorMessage }}</pre>

  </div>

  <div ng-repeat="step in ctrl.scenario.steps">

    <p>
      <tc-element-info info="step.info"></tc-element-info>
      <tc-status status="step.status"></tc-status>
    </p>

    <table ng-if="step.table" class="table table-bordered" style="width: auto">
      <tbody>
      <tr ng-repeat="row in step.table">
        <td ng-repeat="cell in row"><code>{{ cell }}</code></td>
      </tr>
      </tbody>
    </table>

    <pre ng-if="step.errorMessage">{{ step.errorMessage }}</pre>

  </div>

  <div ng-repeat="action in ctrl.scenario.afterActions">
    <p>
      <i><b>Post-action</b> #{{ $index + 1 }}</i>
      <tc-status status="action.status"></tc-status>
    </p>
    <pre ng-if="action.errorMessage">{{ action.errorMessage }}</pre>
  </div>

  <hr>

  <!-- Comments -->

  <h2>Commentaires</h2>

  <div ng-repeat="comment in ctrl.comments">
    <h5>Le {{ comment.date | date:'dd/MM/yyyy à HH:mm:ss' }}</h5>
    <p>
      <tc-line-breaks content="comment.content"></tc-line-breaks>
    </p>
  </div>

  <form ng-controller="AddCommentCtrl as addCommentCtrl">
    <div class="form-group">
      <textarea ng-model="addCommentCtrl.content" class="form-control" rows="3"
                placeholder="Entrez votre commentaire">
      </textarea>
    </div>
    <button ng-click="addCommentCtrl.addComment()" type="submit" class="btn btn-primary">Ajouter le commentaire</button>
  </form>

  <hr>

  <!-- Historique -->

  <h2>Historique</h2>

  <div class="form-inline" style="margin-bottom: 10px">
    <div class="form-group">
      <b>Filtrer :</b>
    </div>
    <div class="checkbox">
      <label>
        <input type="checkbox" ng-model="ctrl.filters.sameTestRun" ng-change="ctrl.updateStoredFilters()">
        Même environnement de tir
      </label>
    </div>
  </div>

  <table class="table table-bordered">
    <thead>
    <tr>
      <th class="col-md-1">Environnement</th>
      <th class="col-md-10">Tir</th>
      <th class="col-md-1">Statut</th>
    </tr>
    </thead>
    <tbody>
    <tr ng-repeat="scenario in ctrl.history | filter:ctrl.isHistoryItemDisplayable | orderBy:'-testRun.date'"
        ng-class="ctrl.scenario.testRunId === scenario.testRun.id && 'active'">
      <td>
        <span class="label label-default">{{ scenario.testRun.env }}</span>
      </td>
      <td>
        <a ng-href="#/scenarii/{{ scenario.id }}">
          {{ scenario.testRun.date | date:'dd/MM/yyyy à HH:mm' }}
        </a>
      </td>
      <td>
        <tc-status status="scenario.status"></tc-status>
      </td>
    </tr>
    </tbody>
  </table>


</div>
